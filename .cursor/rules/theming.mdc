---
description: Theming system rules and CSS variable guidelines
globs: ["packages/ui-tw/**/*", "**/*.css", "**/*.scss"]
alwaysApply: false
---

# Theming System Rules

## üé® CSS Variable Structure

### Color System
All colors must use HSL format and follow the semantic naming convention:

```css
[data-theme="nostromo"] {
  /* Brand colors - primary brand identity */
  --color-brand-500: 262 84% 52%;  /* Primary brand color */
  --color-brand-600: 262 84% 45%;
  --color-brand-700: 262 84% 35%;

  /* Neutral colors - grays and text */
  --color-neutral-50: 0 0% 98%;
  --color-neutral-900: 0 0% 9%;

  /* Semantic colors */
  --color-success-500: 142 76% 36%;
  --color-warning-500: 38 92% 50%;
  --color-error-500: 0 84% 60%;
  --color-info-500: 199 89% 48%;
}
```

### Spacing & Sizing
```css
[data-theme="nostromo"] {
  /* Spacing scale - based on 4px grid */
  --spacing-xs: 0.25rem;   /* 4px */
  --spacing-sm: 0.5rem;    /* 8px */
  --spacing-md: 1rem;      /* 16px */
  --spacing-lg: 1.5rem;    /* 24px */
  --spacing-xl: 2rem;      /* 32px */

  /* Border radius */
  --radius-sm: 0.25rem;    /* 4px */
  --radius-md: 0.5rem;     /* 8px */
  --radius-lg: 0.75rem;    /* 12px */
  --radius-xl: 1rem;       /* 16px */

  /* Shadows */
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
}
```

### Typography
```css
[data-theme="nostromo"] {
  /* Font families */
  --font-heading: "Inter", system-ui, sans-serif;
  --font-body: "Inter", system-ui, sans-serif;
  --font-mono: "JetBrains Mono", "Fira Code", monospace;

  /* Font sizes */
  --text-xs: 0.75rem;      /* 12px */
  --text-sm: 0.875rem;     /* 14px */
  --text-base: 1rem;       /* 16px */
  --text-lg: 1.125rem;     /* 18px */
  --text-xl: 1.25rem;      /* 20px */
  --text-2xl: 1.5rem;      /* 24px */
  --text-3xl: 1.875rem;    /* 30px */
  --text-4xl: 2.25rem;     /* 36px */
  --text-5xl: 3rem;        /* 48px */
}
```

## üé≠ Theme Implementation

### Theme Structure
```css
/* Base theme - always applied */
[data-theme="nostromo"] {
  /* All CSS variables defined here */
}

/* Dark mode variant */
[data-theme="nostromo"][data-color-scheme="dark"] {
  --color-neutral-50: 0 0% 9%;
  --color-neutral-900: 0 0% 98%;
  /* Override other colors as needed */
}

/* System preference */
@media (prefers-color-scheme: dark) {
  [data-theme="nostromo"] {
    --color-neutral-50: 0 0% 9%;
    --color-neutral-900: 0 0% 98%;
  }
}
```

### Custom Theme Creation
```css
/* User-defined custom theme */
[data-theme="mybrand"] {
  /* Brand colors */
  --color-brand-500: 262 84% 52%;
  --color-brand-600: 262 84% 45%;
  --color-brand-700: 262 84% 35%;

  /* Neutral colors */
  --color-neutral-50: 0 0% 98%;
  --color-neutral-900: 0 0% 9%;

  /* Custom styling */
  --radius-md: 0.75rem;
  --font-heading: "Poppins", sans-serif;
  --font-body: "Inter", sans-serif;
}
```

## üé® Tailwind Integration

### Preset Configuration
```js
// tailwind.preset.js
module.exports = {
  theme: {
    extend: {
      colors: {
        brand: {
          50: "hsl(var(--color-brand-50))",
          100: "hsl(var(--color-brand-100))",
          // ... all brand colors
          950: "hsl(var(--color-brand-950))",
        },
        neutral: {
          50: "hsl(var(--color-neutral-50))",
          // ... all neutral colors
          950: "hsl(var(--color-neutral-950))",
        },
        success: {
          500: "hsl(var(--color-success-500))",
        },
        warning: {
          500: "hsl(var(--color-warning-500))",
        },
        error: {
          500: "hsl(var(--color-error-500))",
        },
        info: {
          500: "hsl(var(--color-info-500))",
        },
      },
      borderRadius: {
        sm: "var(--radius-sm)",
        md: "var(--radius-md)",
        lg: "var(--radius-lg)",
        xl: "var(--radius-xl)",
        full: "var(--radius-full)",
      },
      fontFamily: {
        heading: "var(--font-heading)",
        body: "var(--font-body)",
        mono: "var(--font-mono)",
      },
    },
  },
};
```

## üö´ Theming Anti-Patterns

### ‚ùå Don't Do This
```tsx
// Wrong - hardcoded colors
<Button className="bg-brand-500 text-white">Click</Button>
<Card className="bg-white text-neutral-900">Content</Card>
<Input className="border-neutral-200 text-neutral-900" />

// Wrong - dark: prefixes (use CSS variables instead)
<div className="bg-white dark:bg-neutral-900">Content</div>

// Wrong - direct neutral color usage
<span className="text-neutral-600">Muted text</span>
```

### ‚úÖ Do This Instead
```tsx
// Correct - using semantic tokens
<Button className="bg-primary text-primary-foreground">Click</Button>
<Card className="bg-card text-card-foreground">Content</Card>
<Input className="border-border text-foreground" />

// Correct - semantic tokens work in both light and dark mode
<div className="bg-background text-foreground">Content</div>

// Correct - semantic muted colors
<span className="text-muted-foreground">Muted text</span>
```

## üåô Dark Mode Implementation

### Manual Dark Mode
```tsx
// React hook for dark mode
function useDarkMode() {
  const [isDark, setIsDark] = useState(false);
  
  useEffect(() => {
    const root = document.documentElement;
    root.setAttribute('data-color-scheme', isDark ? 'dark' : 'light');
  }, [isDark]);
  
  return [isDark, setIsDark];
}
```

### System Preference
```css
/* Automatic dark mode based on system preference */
@media (prefers-color-scheme: dark) {
  [data-theme="nostromo"] {
    --color-neutral-50: 0 0% 9%;
    --color-neutral-100: 0 0% 15%;
    --color-neutral-200: 0 0% 25%;
    --color-neutral-300: 0 0% 35%;
    --color-neutral-400: 0 0% 45%;
    --color-neutral-500: 0 0% 55%;
    --color-neutral-600: 0 0% 65%;
    --color-neutral-700: 0 0% 75%;
    --color-neutral-800: 0 0% 85%;
    --color-neutral-900: 0 0% 95%;
    --color-neutral-950: 0 0% 98%;
  }
}
```

## üéØ Theme Validation & Best Practices

### Color Contrast Requirements
All color combinations must meet WCAG 2.1 AA standards:
- **Normal text**: 4.5:1 contrast ratio minimum
- **Large text** (18pt+ or 14pt+ bold): 3:1 contrast ratio minimum
- **UI components**: 3:1 contrast ratio minimum

### Semantic Tokens - Always Use These
**ALWAYS** use semantic tokens in components. Never use hardcoded colors:

```tsx
// ‚úÖ CORRECT - Semantic tokens
className="bg-primary text-primary-foreground"
className="bg-card text-card-foreground"
className="bg-muted text-muted-foreground"
className="border-border"
className="text-foreground"

// ‚ùå WRONG - Hardcoded colors
className="bg-brand-500 text-white"
className="bg-white text-neutral-900"
className="bg-neutral-50 text-neutral-600"
className="border-neutral-200"
className="text-neutral-900"
```

### Dark Mode - Use CSS Variables, Not dark: Prefix
**NEVER** use `dark:` prefixes. Semantic tokens automatically adapt:

```tsx
// ‚úÖ CORRECT - Semantic tokens work in both modes
className="bg-background text-foreground"

// ‚ùå WRONG - dark: prefix
className="bg-white dark:bg-neutral-900"
```

### Validation Tools
Run these before committing:
```bash
# Validate all theme contrasts
pnpm validate:theme-contrasts

# Audit components for hardcoded colors
pnpm audit:contrast
```

### Component Development Rules
1. **Always use semantic tokens** - `text-foreground`, `bg-card`, `border-border`, etc.
2. **Never use hardcoded colors** - No `text-neutral-900`, `bg-white`, `border-neutral-200`
3. **Never use dark: prefixes** - Semantic tokens handle dark mode automatically
4. **Validate contrasts** - Run validation tools before committing
5. **Test in both modes** - Ensure components work in light and dark mode

## üîß Theme Utilities

### CSS Custom Properties
```css
/* Utility classes for common patterns */
.text-brand {
  color: hsl(var(--color-brand-500));
}

.bg-brand {
  background-color: hsl(var(--color-brand-500));
}

.border-brand {
  border-color: hsl(var(--color-brand-500));
}

.rounded-theme {
  border-radius: var(--radius-md);
}

.font-heading {
  font-family: var(--font-heading);
}

.font-body {
  font-family: var(--font-body);
}
```

---

**Remember**: All theming should be consistent, accessible, and follow the established patterns. When creating new themes, always test color contrast and ensure compatibility with both light and dark modes.