---
description: Component development patterns and standards
globs: ["packages/ui-core/**/*", "packages/ui-marketing/**/*"]
alwaysApply: false
---

# Component Development Rules

## ğŸ§© Component Structure

### File Organization
```
packages/ui-core/src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ button.tsx                    # React component
â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â”œâ”€â”€ button.test.tsx          # Unit tests
â”‚   â”‚   â””â”€â”€ button.a11y.test.tsx     # Accessibility tests
â”‚   â””â”€â”€ __stories__/
â”‚       â””â”€â”€ Button.stories.tsx       # Storybook stories
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ utils.ts                      # Utility functions
â””â”€â”€ index.ts                          # Package exports
```

### Component Template
```tsx
// React component template
import { cva, type VariantProps } from "class-variance-authority";
import { cn } from "@/lib/utils";

const componentVariants = cva(
  // Base classes
  "base-classes-here",
  {
    variants: {
      variant: {
        primary: "primary-classes",
        secondary: "secondary-classes",
      },
      size: {
        sm: "small-classes",
        md: "medium-classes",
        lg: "large-classes",
      },
    },
    defaultVariants: {
      variant: "primary",
      size: "md",
    },
  }
);

export interface ComponentProps
  extends React.HTMLAttributes<HTMLElement>,
    VariantProps<typeof componentVariants> {
  // Additional props
}

export const Component = React.forwardRef<HTMLElement, ComponentProps>(
  ({ className, variant, size, ...props }, ref) => {
    return (
      <element
        className={cn(componentVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    );
  }
);

Component.displayName = "Component";
```

## ğŸ¨ Styling Guidelines

### Tailwind Classes
- **Use utility classes** for all styling
- **Combine with CVA** for variant management
- **Use CSS variables** for theme-aware colors
- **Avoid custom CSS** unless absolutely necessary

### Color Usage
```tsx
// âœ… Correct - using CSS variables
className="bg-brand-500 text-white hover:bg-brand-600"

// âŒ Wrong - hardcoded colors
className="bg-purple-500 text-white hover:bg-purple-600"
```

### Spacing & Sizing
```tsx
// âœ… Correct - using design tokens
className="p-4 rounded-md text-base"

// âŒ Wrong - arbitrary values
className="p-[16px] rounded-[8px] text-[16px]"
```

## ğŸ”§ Variant System

### Standard Variants
All components should support these standard variants:

```tsx
type Size = "sm" | "md" | "lg";
type Variant = "primary" | "secondary" | "ghost" | "destructive";
type State = "default" | "loading" | "disabled";
```

### CVA Implementation
```tsx
const buttonVariants = cva(
  // Base classes - always applied
  "inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        primary: "bg-brand-500 text-white hover:bg-brand-600",
        secondary: "bg-neutral-200 text-neutral-900 hover:bg-neutral-300",
        ghost: "hover:bg-neutral-100 hover:text-neutral-900",
        destructive: "bg-error-500 text-white hover:bg-error-600",
      },
      size: {
        sm: "h-8 px-3 text-sm",
        md: "h-10 px-4 text-base",
        lg: "h-12 px-6 text-lg",
      },
    },
    defaultVariants: {
      variant: "primary",
      size: "md",
    },
  }
);
```

## â™¿ Accessibility Requirements

### ARIA Attributes
```tsx
// âœ… Correct - proper ARIA
<button
  aria-label={isLoading ? "Loading..." : "Submit form"}
  aria-disabled={isLoading}
  disabled={isLoading}
>
  {isLoading ? <Spinner /> : "Submit"}
</button>

// âŒ Wrong - missing ARIA
<button disabled={isLoading}>
  {isLoading ? <Spinner /> : "Submit"}
</button>
```

### Keyboard Navigation
```tsx
// âœ… Correct - keyboard support
<div
  role="button"
  tabIndex={0}
  onKeyDown={(e) => {
    if (e.key === "Enter" || e.key === " ") {
      e.preventDefault();
      onClick?.();
    }
  }}
  onClick={onClick}
>
  Clickable div
</div>
```

### Focus Management
```tsx
// âœ… Correct - focus trap for modals
<Dialog>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>Modal Title</DialogTitle>
    </DialogHeader>
    {/* Content */}
  </DialogContent>
</Dialog>
```

## ğŸ§ª Testing Standards

### Unit Tests
```tsx
// src/components/__tests__/button.test.tsx
import { render, screen, fireEvent } from "@testing-library/react";
import { Button } from "../button";

describe("Button", () => {
  it("renders with correct text", () => {
    render(<Button>Click me</Button>);
    expect(screen.getByRole("button")).toHaveTextContent("Click me");
  });

  it("handles click events", () => {
    const handleClick = jest.fn();
    render(<Button onClick={handleClick}>Click me</Button>);
    
    fireEvent.click(screen.getByRole("button"));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });

  it("applies correct variant classes", () => {
    render(<Button variant="primary">Primary</Button>);
    expect(screen.getByRole("button")).toHaveClass("bg-brand-500");
  });
});
```

### Accessibility Tests
```tsx
// src/components/__tests__/button.a11y.test.tsx
import { render } from "@testing-library/react";
import { axe, toHaveNoViolations } from "jest-axe";
import { Button } from "../button";

expect.extend(toHaveNoViolations);

describe("Button Accessibility", () => {
  it("has no accessibility violations", async () => {
    const { container } = render(<Button>Click me</Button>);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });
});
```

## ğŸ“š Storybook Stories

### Story Location
- **All stories** must be placed in `src/components/__stories__/` folder
- **Naming**: Use PascalCase matching component name (e.g., `Button.stories.tsx`)
- **Title**: Use `Components/[ComponentName]` or `Components/[Category]/[ComponentName]` format

### Story Template
```tsx
// src/components/__stories__/Button.stories.tsx
import React from 'react';
import type { Meta, StoryObj } from "@storybook/react-vite";
import { Button } from "../button";

const meta: Meta<typeof Button> = {
  title: "Components/Button",
  component: Button,
  parameters: {
    layout: "centered",
    docs: {
      description: {
        component: 'A versatile button component with multiple variants and sizes.',
      },
    },
  },
  tags: ["autodocs"],
  argTypes: {
    variant: {
      control: { type: "select" },
      options: ["default", "destructive", "outline", "secondary", "ghost", "link"],
      description: 'Visual variant of the button',
    },
    size: {
      control: { type: "select" },
      options: ["sm", "default", "lg", "icon"],
      description: 'Size of the button',
    },
    loading: {
      control: { type: "boolean" },
      description: 'Show loading spinner',
    },
    disabled: {
      control: { type: "boolean" },
      description: 'Disable the button',
    },
  },
};

export default meta;
type Story = StoryObj<typeof meta>;

export const Default: Story = {
  args: {
    variant: "default",
    children: "Button",
  },
};

export const Destructive: Story = {
  args: {
    variant: "destructive",
    children: "Delete",
  },
};

export const Loading: Story = {
  args: {
    loading: true,
    children: "Loading...",
  },
};
```

## ğŸ“¦ Export Patterns

### Package Exports (src/index.ts)
```ts
// src/index.ts - Main package exports
export { Button, buttonVariants } from './components/button';
export type { ButtonProps } from './components/button';

// Individual component exports for tree-shaking
// These are configured in package.json exports field
```

### Package.json Exports Configuration
```json
{
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "import": "./dist/index.js",
      "require": "./dist/index.cjs",
      "default": "./dist/index.js"
    },
    "./button": {
      "types": "./dist/components/button.d.ts",
      "import": "./dist/components/button.js",
      "require": "./dist/components/button.cjs"
    }
  }
}
```

### Monorepo Workspace Dependencies
```json
{
  "dependencies": {
    "@nostromo/ui-tw": "workspace:^"
  },
  "devDependencies": {
    "@nostromo/ui-core": "workspace:*"
  }
}
```

**Note**: Use `workspace:^` for dependencies and `workspace:*` for devDependencies in monorepo setup.

## ğŸ“¦ Monorepo Patterns

### Workspace Protocol
```json
{
  "dependencies": {
    "@nostromo/ui-tw": "workspace:^"
  }
}
```

### Internal Package Imports
```tsx
// In ui-core components
import { cn } from '../lib/utils';
import { buttonVariants } from './button';

// In tests/stories
import { Button } from '../button';
```

### Storybook Configuration
Stories are automatically discovered from `src/**/*.stories.@(js|jsx|mjs|ts|tsx|mdx)` pattern. The Storybook config uses `@tailwindcss/vite` plugin for Tailwind v4 support.

## ğŸš« Common Mistakes to Avoid

### Styling Mistakes
- âŒ Don't use hardcoded colors
- âŒ Don't mix CSS-in-JS with Tailwind
- âŒ Don't use arbitrary values without good reason
- âŒ Don't forget to handle dark mode

### Accessibility Mistakes
- âŒ Don't forget ARIA attributes
- âŒ Don't ignore keyboard navigation
- âŒ Don't skip focus management
- âŒ Don't forget to test with screen readers

### Performance Mistakes
- âŒ Don't add unnecessary re-renders
- âŒ Don't forget to memoize expensive calculations
- âŒ Don't ignore bundle size impact
- âŒ Don't add runtime dependencies

---

**Remember**: Every component should be accessible, performant, and follow established patterns. When in doubt, check existing components for reference.
**Remember**: Every component should be accessible, performant, and follow established patterns. When in doubt, check existing components for reference.